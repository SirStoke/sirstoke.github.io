<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Random stuff</title>
        <link>https://sirstoke.github.io</link>
        <description>Mostly CS. Probably</description>
        <generator>Zola</generator>
        <language>en</language>
        <atom:link href="https://sirstoke.github.io/rss.xml" rel="self" type="application/rss+xml"/>
        <lastBuildDate>Fri, 22 Mar 2019 00:00:00 +0000</lastBuildDate>
        
            <item>
                <title>A Song of Bluetooth chinese lamp &amp; excruciating reverse engineering - Day 3</title>
                <pubDate>Fri, 22 Mar 2019 00:00:00 +0000</pubDate>
                <link>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-3/</link>
                <guid>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-3/</guid>
                <description>&lt;p&gt;&lt;a href=&quot;https:&#x2f;&#x2f;sirstoke.github.io&#x2f;chinese-lamp-reverse-engineer-day-2&#x2f;&quot;&gt;Previous article&lt;&#x2f;a&gt;&lt;&#x2f;p&gt;
&lt;h2 id=&quot;g0t-r00t-w00t&quot;&gt;G0t r00t w00t&lt;&#x2f;h2&gt;
&lt;p&gt;Once I got my device rooted I started looking for Frida docs and tutorials. &lt;code&gt;frida-server&lt;&#x2f;code&gt; seemed the most basic way to get frida up and running on a process, but it hanged without erroring (I was pretty sure the process was ptrace-ing himself already).&lt;&#x2f;p&gt;
&lt;p&gt;Apparently Frida provides a shared object (called &lt;a href=&quot;https:&#x2f;&#x2f;frida.re&#x2f;docs&#x2f;gadget&#x2f;&quot;&gt;&amp;quot;gadget&amp;quot;&lt;&#x2f;a&gt;) that you can inject using something like &lt;code&gt;LD_PRELOAD&lt;&#x2f;code&gt;&lt;&#x2f;p&gt;
&lt;p&gt;So I learned how to &lt;a href=&quot;https:&#x2f;&#x2f;koz.io&#x2f;using-frida-on-android-without-root&#x2f;&quot;&gt;load a frida gadget&lt;&#x2f;a&gt; and that seemed straightforward enough. I moved the gadget under &lt;code&gt;lib&#x2f;armaebi&#x2f;libstocazzo.so&lt;&#x2f;code&gt; and then added some smali bytecode in the &lt;code&gt;s&#x2f;h&#x2f;e&#x2f;l&#x2f;l&#x2f;S&lt;&#x2f;code&gt; constructor:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;    const-string v9, &amp;quot;stocazzo&amp;quot;
    const-string v8, &amp;quot;Loading stocazzo&amp;quot;
    invoke-static {v9, v8}, Landroid&#x2f;util&#x2f;Log;-&amp;gt;i(Ljava&#x2f;lang&#x2f;String;Ljava&#x2f;lang&#x2f;String;)I

    const-string v14, &amp;quot;stocazzo&amp;quot;
    invoke-static {v14}, Ljava&#x2f;lang&#x2f;System;-&amp;gt;loadLibrary(Ljava&#x2f;lang&#x2f;String;)V

    const-string v10, &amp;quot;Finished loading stocazzo&amp;quot;
    invoke-static {v9, v10}, Landroid&#x2f;util&#x2f;Log;-&amp;gt;i(Ljava&#x2f;lang&#x2f;String;Ljava&#x2f;lang&#x2f;String;)I
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;I know you italian people are either chuckling or leaving the website. I don&#x27;t regret anything.&lt;&#x2f;p&gt;
&lt;p&gt;Anyway, after repacking, signing and &lt;code&gt;logcat 2&amp;gt;&amp;amp;1 | grep stocazzo&lt;&#x2f;code&gt;-ing I was seeing the first log and not the second. On the bright side I could see the Gadget process with &lt;code&gt;frida-ps -U&lt;&#x2f;code&gt;, and I called this a success, because at least I could now debug Frida with Frida. I was seriously happy.&lt;&#x2f;p&gt;
&lt;p&gt;Except &lt;code&gt;frida-trace -U Gadget&lt;&#x2f;code&gt; was crashing the gadget. The &lt;em&gt;gadget&lt;&#x2f;em&gt; was crashing, not the actual app. And my happiness faded away in an instant.&lt;&#x2f;p&gt;
&lt;p&gt;(Frida didn&#x27;t work on Android 9 at the time, that&#x27;s why it was crashing. They &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;frida&#x2f;frida-java&#x2f;commit&#x2f;7fe0e72de1beba4849179adc5e4e8eb2e8e9e04e&quot;&gt;fixed&lt;&#x2f;a&gt; it more or less a month later)&lt;&#x2f;p&gt;
&lt;p&gt;I was feeling hopeless at this time. I seriously was. How was I supposed to continue my reverse engineering if apparently even the most used tool for this job wasn&#x27;t working? &lt;&#x2f;p&gt;
&lt;h2 id=&quot;let-s-sniff-some&quot;&gt;Let&#x27;s sniff some&lt;&#x2f;h2&gt;
&lt;p&gt;I decided to change plans. Maybe there was a way to sniff bluetooth packets? &lt;a href=&quot;https:&#x2f;&#x2f;stackoverflow.com&#x2f;questions&#x2f;23877761&#x2f;sniffing-logging-your-own-android-bluetooth-traffic&quot;&gt;There was&lt;&#x2f;a&gt;, but it seemed to not work on my OnePlus 6.&lt;&#x2f;p&gt;
&lt;p&gt;And then something mystic happened: I started wireshark up and a mysterious &amp;quot;One Plus 6&amp;quot; device showed up. Could it be that we can sniff bluetooth packets from wireshark?&lt;&#x2f;p&gt;
&lt;p&gt;My hand was shaking as I clicked on that device and quickly added a &lt;code&gt;bluetooth&lt;&#x2f;code&gt; filter. I was seeing packets come and go, and the traffic stopped once the app was killed. I started to feel joy again.&lt;&#x2f;p&gt;
&lt;p&gt;(After some googling I understood that I can access my phone as a wireshark interface because of &lt;a href=&quot;https:&#x2f;&#x2f;www.wireshark.org&#x2f;docs&#x2f;man-pages&#x2f;androiddump.html&quot;&gt;androiddump&lt;&#x2f;a&gt;. I fucking love wireshark.)&lt;&#x2f;p&gt;
&lt;p&gt;There was still a problem at this point: I knew nothing about bluetooth, but luckily the app seemed to only exchange SPP and L2CAP packets. It was time to get a bit more practical.&lt;&#x2f;p&gt;
&lt;p&gt;I started looking at packets and the app was sending an heartbeat (as SPP packet) composed of these bytes:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;[0x01, 0xfe, 0x00, 0x00, 0x51, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80]
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;And the lamp was answering with:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;01:fe:00:00:41:00:28:00:00:00:00:00:00:00:00:00:00:1f:00:1f:00:00:00:05:00:00:00:00:00:00:00:00:00:2a:a1:12:02:e0:c1:9f
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;All of this on channel number 2.&lt;&#x2f;p&gt;
&lt;p&gt;I didn&#x27;t want to dig into what this actually meant as I was not ready to lose my sanity (and joy).&lt;&#x2f;p&gt;
&lt;p&gt;Time to write some code. After Googling deep for 3-4 hours in an attempt to understand the difference between SPP, SDP and L2CAP packets I found &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;eelcocramer&#x2f;node-bluetooth-serial-port&quot;&gt;this&lt;&#x2f;a&gt; library and wrote a very basic node.js script:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= new (&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;require&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bluetooth-serial-port&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;)).&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;BluetoothSerialPort&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;address &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &amp;quot;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;redacted&amp;gt;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Buffer&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;from&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xfe&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x51&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x10&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x80&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x80&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;])

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;connect&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;address&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
  console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;connected&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);

  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;write&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;value&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(err, bytesWritten) {
    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
  });

  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(buffer) {
    console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(buffer);
  });
}, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
  console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;cannot connect&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);
});
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;And back I received:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;lt;Buffer 01 fe 00 00 41 00 28 00 00 00 00 00 00 00 00 00 00 1f 00 1f 00 00 00 05 00 00 00 00 00 00 00 00 00 2a a1 12 02 e0 c1 9f&amp;gt;
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;Too much success in a day. I was fearing for something very bad.&lt;&#x2f;p&gt;
&lt;p&gt;Turning off the lights resulted in this SPP packet being sent:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;01:fe:00:00:51:81:18:00:00:00:00:00:00:00:00:00:0d:07:01:03:01:02:0e:00
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;And sending it &lt;em&gt;was turning the lights off&lt;&#x2f;em&gt;. I was about to cry.&lt;&#x2f;p&gt;
&lt;p&gt;The packet to turn them on was:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#c0c5ce;&quot;&gt;01:fe:00:00:51:81:18:00:00:00:00:00:00:00:00:00:0d:07:01:03:01:01:0e:00
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;Which differs from the other packet for only a byte (01 instead of 02).&lt;&#x2f;p&gt;
&lt;p&gt;This lamp has RGB capabilities, but for reasons I think are obvious I chose not to investigate that. If somebody has the courage to do that please let me know!&lt;&#x2f;p&gt;
&lt;p&gt;Choosing the smart home assistant was easy as Google Home actions have to be published before they can be used (i.e you can&#x27;t build actions only you will use). Pretty idiotic if you ask me. Anyway, Alexa was chosen as my smart home empress.&lt;&#x2f;p&gt;
&lt;p&gt;Time to setup my Raspberry.&lt;&#x2f;p&gt;
&lt;p&gt;I&#x27;m an hardcore &lt;a href=&quot;https:&#x2f;&#x2f;archlinux.org&quot;&gt;archlinux&lt;&#x2f;a&gt; fan, but it needs an ethernet cable to install. In 2019. I guess i&#x27;m going with Raspbian.&lt;&#x2f;p&gt;
&lt;p&gt;After following &lt;a href=&quot;https:&#x2f;&#x2f;www.raspberrypi.org&#x2f;documentation&#x2f;configuration&#x2f;wireless&#x2f;headless.md&quot;&gt;these&lt;&#x2f;a&gt; instruction in order to be as lazy as possible, and after having them fail on me and almost choke on a myriad of cables coming from and going to my raspberry, I had a Raspbian setup.&lt;&#x2f;p&gt;
&lt;p&gt;I was expecting some trouble with the native module &lt;code&gt;node-bluetooth-serial-port&lt;&#x2f;code&gt; is using, but it actually worked on the raspberry the first time. I was incredibily surprised.&lt;&#x2f;p&gt;
&lt;p&gt;I wanted to have HTTP calls to control the lights and properly clean the bluetooth connection upon exit. This is what I ended up writing:&lt;&#x2f;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= new (&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;require&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;bluetooth-serial-port&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;)).&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;BluetoothSerialPort&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;express  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;require&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;express&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;app &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;express&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;address &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &amp;quot;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&amp;lt;redacted&amp;gt;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;var &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;2

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ping &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Buffer&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;from&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xfe&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x51&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x10&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x80&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x80&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;]);
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;shutoff &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Buffer&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;from&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xfe&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x51&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x81&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x18&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x0d&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x07&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x03&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x02&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x0e&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;]);
&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;let &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;turnon &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;= &lt;&#x2f;span&gt;&lt;span style=&quot;color:#ebcb8b;&quot;&gt;Buffer&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;from&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0xfe&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x51&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x81&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x18&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x0d&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x07&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x03&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x01&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x0e&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;,&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0x00&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;]);

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;connect&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;address&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;channel&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
  console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Connected to lamp&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);

  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;setInterval&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;write&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;ping&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(err, bytesWritten) {
      &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);

      console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Pinged lamp&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);
    })
  }, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;500&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);

  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(buffer) {
    console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(buffer);
  });

  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;app&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;listen&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(process.env[&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;PORT&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;] || &lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;3000&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, () &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;HTTP server listening!&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;));
}, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
  console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Failed to connect&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;);

  process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;exit&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
});

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;app&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;post&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&#x2f;lights&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, (req, res) &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;{
  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;write&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;turnon&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(err, bytesWritten) {
    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);

    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;res&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;send&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&amp;#39;);
  });
});

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;app&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;delete&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;&#x2f;lights&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, (req, res) &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;=&amp;gt; &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;{
  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;write&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;shutoff&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(err, bytesWritten) {
    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;if &lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) console.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;log&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;err&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);

    &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;res&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;send&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&amp;#39;);
  });
});

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;inquire&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();

&lt;&#x2f;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;function &lt;&#x2f;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() {
  &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;btSerial&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;close&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();

  process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;exit&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;();
}


process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;exit&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;SIGINT&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;SIGUSR1&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;SIGUSR2&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
process.&lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;on&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2f;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;uncaughtException&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;, &lt;&#x2f;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;cleanup&lt;&#x2f;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;);
&lt;&#x2f;span&gt;&lt;&#x2f;pre&gt;
&lt;p&gt;It was 4AM, and decided that was it for the day.&lt;&#x2f;p&gt;
</description>
            </item>
        
            <item>
                <title>A Song of Bluetooth chinese lamp &amp; excruciating reverse engineering - Day 2</title>
                <pubDate>Tue, 05 Mar 2019 00:00:00 +0000</pubDate>
                <link>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-2/</link>
                <guid>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-2/</guid>
                <description>&lt;p&gt;&lt;a href=&quot;https:&#x2f;&#x2f;sirstoke.github.io&#x2f;chinese-lamp-reverse-engineer-day-1&#x2f;&quot;&gt;Previous article&lt;&#x2f;a&gt;&lt;&#x2f;p&gt;
&lt;h2 id=&quot;we-need-to-go-deeper&quot;&gt;We need to go deeper&lt;&#x2f;h2&gt;
&lt;p&gt;At this point I knew that I needed to do what all the cool kids are doing nowadays and &lt;a href=&quot;https:&#x2f;&#x2f;en.wikipedia.org&#x2f;wiki&#x2f;Piracy&quot;&gt;totally buy&lt;&#x2f;a&gt; IDA Pro, but I wanted to try and go on the open source path. So I again turned to Google and found &lt;a href=&quot;https:&#x2f;&#x2f;rada.re&#x2f;r&#x2f;&quot;&gt;radare2&lt;&#x2f;a&gt;, and even better I found &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;radareorg&#x2f;cutter&quot;&gt;Cutter&lt;&#x2f;a&gt;, an experimental GUI for radare2.&lt;&#x2f;p&gt;
&lt;p&gt;I should also point out that I was reversing the x86 version of the packer because I am just more accustomed to x86 assembly. Sorry not sorry.&lt;&#x2f;p&gt;
&lt;p&gt;&lt;code&gt;Readelf -a&lt;&#x2f;code&gt; never fails to amaze me and it found multiple entrypoints:&lt;&#x2f;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2f;images&#x2f;libexec_entrypoints.png&quot; alt=&quot;YOU GET AN ENTRYPOINT! AND YOU GET AN ENTRYPOINT! EVERYONE..&quot; &#x2f;&gt;&lt;&#x2f;p&gt;
&lt;p&gt;Fired Cutter up, opened &lt;code&gt;x86&#x2f;libexec.so&lt;&#x2f;code&gt;, added a symbol to &lt;code&gt;+0x3b530&lt;&#x2f;code&gt; and started looking around.&lt;&#x2f;p&gt;
&lt;p&gt;&lt;em&gt;Everything&lt;&#x2f;em&gt; except the bytes around that function look gibberish, and that usually is pretty promising. I spark with joy recognizing some &lt;code&gt;INT 0x80&lt;&#x2f;code&gt; after &lt;code&gt;mov eax, 9&lt;&#x2f;code&gt; (mmap).&lt;&#x2f;p&gt;
&lt;p&gt;I see that Cutter has a big play button, and after sprinkling breakpoints on some &lt;code&gt;call&lt;&#x2f;code&gt;s I click on it. Cutter suddenly switches to an horrible black theme and &lt;code&gt;push&lt;&#x2f;code&gt; instructions don&#x27;t seem to work (they literally don&#x27;t put the value on the stack).&lt;&#x2f;p&gt;
&lt;p&gt;At the time of writing Cutter is considered beta software. Maybe learning radare2 cli can help?&lt;&#x2f;p&gt;
&lt;p&gt;I spend the rest of the evening reading the radare2 &lt;a href=&quot;https:&#x2f;&#x2f;radare.gitbooks.io&#x2f;radare2book&#x2f;content&#x2f;&quot;&gt;official book&lt;&#x2f;a&gt; (it looked &lt;em&gt;very&lt;&#x2f;em&gt; cool) and already being a vim user I felt quite at home.&lt;&#x2f;p&gt;
&lt;p&gt;But I was still having problems with actually running the function.&lt;&#x2f;p&gt;
&lt;p&gt;I decided to chat about this project with a &lt;a href=&quot;https:&#x2f;&#x2f;twitter.com&#x2f;wsxarcher&quot;&gt;dear friend&lt;&#x2f;a&gt; of mine that works in the cybersecurity field and he recommended &lt;a href=&quot;http:&#x2f;&#x2f;www.giovanni-rocca.com&#x2f;&quot;&gt;Giovanni Rocca&#x27;s blog&lt;&#x2f;a&gt;.&lt;&#x2f;p&gt;
&lt;p&gt;After reading Giovanni&#x27;s blog (&lt;a href=&quot;http:&#x2f;&#x2f;www.giovanni-rocca.com&#x2f;giving-yourself-a-window-to-debug-a-shared-library-before-dt_init-with-frida-on-android&#x2f;&quot;&gt;this&lt;&#x2f;a&gt; particular article to be precise) I am convinced I need to use &lt;a href=&quot;https:&#x2f;&#x2f;www.frida.re&#x2f;&quot;&gt;frida&lt;&#x2f;a&gt; and that, in general, I must continue my dynamic analysis on a real phone. Time to root my OnePlus 6. And I need to do this on Windows. Darn it.&lt;&#x2f;p&gt;
&lt;p&gt;TL;DR for the day: Wasted an evening learning radare2, ended up using Frida AND needed to use the worst OS I could end up using.&lt;&#x2f;p&gt;
</description>
            </item>
        
            <item>
                <title>Whoami</title>
                <pubDate>Sat, 02 Mar 2019 00:00:00 +0000</pubDate>
                <link>https://sirstoke.github.io/pages/about/</link>
                <guid>https://sirstoke.github.io/pages/about/</guid>
                <description>&lt;p&gt;&lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;SirStoke&quot;&gt;I&lt;&#x2f;a&gt; am mostly a pure FP Scala developer, longtime Archlinux user and I once loved to reverse engineer and exploit stuff. I also am a quite avid videogamer.&lt;&#x2f;p&gt;
&lt;p&gt;I currently work as the Lead dev for &lt;a href=&quot;https:&#x2f;&#x2f;www.efficiam.com&quot;&gt;Efficiam&lt;&#x2f;a&gt;&lt;&#x2f;p&gt;
</description>
            </item>
        
            <item>
                <title>A Song of Bluetooth chinese lamp &amp; excruciating reverse engineering - Day 1</title>
                <pubDate>Fri, 01 Mar 2019 00:00:00 +0000</pubDate>
                <link>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-1/</link>
                <guid>https://sirstoke.github.io/chinese-lamp-reverse-engineer-day-1/</guid>
                <description>&lt;h2 id=&quot;prologue&quot;&gt;Prologue&lt;&#x2f;h2&gt;
&lt;p&gt;&#x27;twas a cold november evening, and it was probably raining (or maybe it&#x27;s just how I picture it now).&lt;&#x2f;p&gt;
&lt;p&gt;Christmas was fast-approaching and I learned through bad experiences that dropping hints on what family and friends could gift me would save me from awkward fake smiles and celebrations later.&lt;&#x2f;p&gt;
&lt;p&gt;One thing I thought of was one of those cloud-enabled smart bulbs &lt;strong&gt;that already have&lt;&#x2f;strong&gt; integrations with Amazon Alexa or Google Home. You just put the bulb in the socket, swiftly navigate through 2 or 3 web UIs and boom, you should be all set and already living in the future.&lt;&#x2f;p&gt;
&lt;p&gt;So I dropped that hint during a family dinner and my mom immediately started asking more info, but I neglected her with some brief answers. Oh boy, if only I knew what was going to happen.&lt;&#x2f;p&gt;
&lt;p&gt;Christmas night came, and with it came the time to unwrap my mom&#x27;s gift. Something was off. It wasn&#x27;t a &lt;em&gt;bulb&lt;&#x2f;em&gt;, it was an entire &lt;em&gt;lamp&lt;&#x2f;em&gt;, and not from a brand I knew. While opening the box I remember thinking &amp;quot;Please be WiFi, please be WiFi&amp;quot;. It was Bluetooth.&lt;&#x2f;p&gt;
&lt;p&gt;Well, maybe not all hope is lost, maybe the company manufacturing these lamps is a good, well versed company. Nope, It&#x27;s chinese, and they make you download the android app from a shady site (not from Google Play).&lt;&#x2f;p&gt;
&lt;p&gt;No Alexa&#x2f;Google Home integration: you can only turn it on from the app. And the app displays some random chinese ads every time I open it (which is a lot).&lt;&#x2f;p&gt;
&lt;p&gt;Maybe reverse engineering the app is easy?&lt;&#x2f;p&gt;
&lt;h2 id=&quot;start-of-the-downfall&quot;&gt;Start of the downfall&lt;&#x2f;h2&gt;
&lt;p&gt;Holidays were still ongoing and I still had ~6-7 free (as in not working) days left.&lt;&#x2f;p&gt;
&lt;p&gt;I decided it could be fun to no matter what it takes, go as deep in the rabbit hole as necessary to reverse engineer the app (for at least 8 hours-per-day), have my Raspberry PI that was lying around unused for more than a year control the lights and control that via a smart home assistant.&lt;&#x2f;p&gt;
&lt;p&gt;I had literally no idea on how Bluetooth communication works, so the plan also included to learn that. I guessed that learning from the app code once reversed properly was the right thing to do.&lt;&#x2f;p&gt;
&lt;p&gt;The journey started searching for reverse engineering tooling for android (I have a &lt;em&gt;very basic&lt;&#x2f;em&gt; understanding on how Android works), and I immediately found &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;google&#x2f;enjarify&quot;&gt;enjarify&lt;&#x2f;a&gt;, &lt;a href=&quot;https:&#x2f;&#x2f;ibotpeaches.github.io&#x2f;Apktool&#x2f;&quot;&gt;apktool&lt;&#x2f;a&gt; and &lt;a href=&quot;https:&#x2f;&#x2f;www.benf.org&#x2f;other&#x2f;cfr&#x2f;&quot;&gt;cfr&lt;&#x2f;a&gt;. After a round of apktool + enjarify + cfr I could already see that something was off: cfr found the main &lt;code&gt;Activity&lt;&#x2f;code&gt; to be empty and the smali only consisted of a bunch of &lt;code&gt;nop&lt;&#x2f;code&gt;s.&lt;&#x2f;p&gt;
&lt;p&gt;As I was feeling the start of an headache I knew it was time to go deeper. Googling for smali tooling found &lt;a href=&quot;https:&#x2f;&#x2f;github.com&#x2f;JesusFreke&#x2f;smali&quot;&gt;baksmali&lt;&#x2f;a&gt;. Manually baksmaling all the dex files (I was starting to doubt apktool) only found an endless and soulless list of nops in all the methods.&lt;&#x2f;p&gt;
&lt;p&gt;Was there a possibility of multiple entrypoints? Googling out and about finally led me to &lt;a href=&quot;https:&#x2f;&#x2f;developer.android.com&#x2f;reference&#x2f;android&#x2f;app&#x2f;Application&quot;&gt;this&lt;&#x2f;a&gt; page, explaining that there could be an &lt;code&gt;Application&lt;&#x2f;code&gt; class defined in the &lt;code&gt;AndroidManifest&lt;&#x2f;code&gt;, and there it was: &lt;code&gt;s&#x2f;h&#x2f;e&#x2f;l&#x2f;l&#x2f;S&lt;&#x2f;code&gt; (what a peculiar name choice btw). Cfr did not work on this class (it decompiled to a bunch of nonsense), and when this news hit me I could feel my head starting to catch fire.&lt;&#x2f;p&gt;
&lt;p&gt;After a big and deep breath I dived into the &lt;code&gt;S&lt;&#x2f;code&gt; class smali with the help of the almighty &lt;a href=&quot;http:&#x2f;&#x2f;pallergabor.uw.hu&#x2f;androidblog&#x2f;dalvik_opcodes.html&quot;&gt;reference&lt;&#x2f;a&gt;. &lt;code&gt;S&lt;&#x2f;code&gt; calls the method &lt;code&gt;ra&lt;&#x2f;code&gt; of the class &lt;code&gt;N&lt;&#x2f;code&gt;, which is a JNI native method. &lt;code&gt;N&lt;&#x2f;code&gt; seems to load a native &lt;code&gt;libexec.so&lt;&#x2f;code&gt;, which I found under &lt;code&gt;assets&#x2f;ijm_lib&#x2f;{armeabi, x86}&lt;&#x2f;code&gt;. At this point my head was almost exploding.&lt;&#x2f;p&gt;
&lt;p&gt;It was 3 AM, and I was googling if somebody encountered this already and perhaps wrote something to unpack it? &lt;a href=&quot;https:&#x2f;&#x2f;www4.comp.polyu.edu.hk&#x2f;%7Ecsxluo&#x2f;DexHunter.pdf&quot;&gt;This paper&lt;&#x2f;a&gt; described exactly what I was looking for, but I could not get any of that to work. I also ended up on a random chinese forum which I tried translating with Google Translate. Turns out people usually use IDA and dump the process memory to unpack this particular packer. That seemed a bit convoluted to work for me, so I decided to continue with static analysis. And also go to bed for the day.&lt;&#x2f;p&gt;
&lt;h2 id=&quot;notes&quot;&gt;Notes&lt;&#x2f;h2&gt;
&lt;p&gt;I couldn&#x27;t find the exact lamp but it comes from the same company that makes &lt;a href=&quot;https:&#x2f;&#x2f;www.amazon.com&#x2f;HOREVO-Dimmable-Bluetooth-Cellphone-Temperature&#x2f;dp&#x2f;B01HCRSIXE&#x2f;ref=sr_1_1?keywords=HOREVO&amp;amp;qid=1551544293&amp;amp;s=gateway&amp;amp;sr=8-1&quot;&gt;this&lt;&#x2f;a&gt; lamp (Horevo). The app also appears to be the same from the screenshots.&lt;&#x2f;p&gt;
</description>
            </item>
        
    </channel>
</rss>
